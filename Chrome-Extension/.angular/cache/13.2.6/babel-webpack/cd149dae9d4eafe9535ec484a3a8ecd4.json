{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/connections/connections.service\";\nimport * as i2 from \"src/app/services/globals/global-vars.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../ui-components/toggle-switch/toggle-switch.component\";\n\nfunction InitUserComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelement(1, \"img\", 4);\n    i0.ɵɵelementStart(2, \"h1\", 5);\n    i0.ɵɵtext(3, \"Welcome to Base Camp\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h2\", 5);\n    i0.ɵɵtext(5, \"Lets get set up\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_1_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.state = \"cloud\";\n    });\n    i0.ɵɵtext(7, \"Setup\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction InitUserComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 7)(2, \"img\", 8);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_2_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.state = \"init\";\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"h1\", 5);\n    i0.ɵɵtext(4, \"Would you like to sync your data with the cloud?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"h3\", 5);\n    i0.ɵɵtext(6, \"Enabling cloud sync would keep a remote backup of your data and allow you to share across various devices\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 9)(8, \"app-toggle-switch\", 10);\n    i0.ɵɵlistener(\"state\", function InitUserComponent_div_2_Template_app_toggle_switch_state_8_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.updateCloudState($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_2_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.state = \"user\";\n    });\n    i0.ɵɵtext(10, \"Next\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"label1\", \"Enable Cloud Sync\")(\"label2\", \"Disable Cloud Sync\")(\"defaultVal\", \"label1\")(\"elemID\", \"initSyncToggle\");\n  }\n}\n\nfunction InitUserComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 7)(2, \"img\", 8);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_3_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.state = \"cloud\";\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"h1\", 5);\n    i0.ɵɵtext(4, \"Do you have an account already?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_3_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.state = \"login\";\n    });\n    i0.ɵɵtext(6, \"Yes\");\n    i0.ɵɵelement(7, \"br\");\n    i0.ɵɵtext(8, \"Log in\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_3_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.state = \"signup\";\n    });\n    i0.ɵɵtext(10, \"No\");\n    i0.ɵɵelement(11, \"br\");\n    i0.ɵɵtext(12, \"Sign up\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction InitUserComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 7)(2, \"img\", 8);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_4_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.state = \"user\";\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"h1\", 5);\n    i0.ɵɵtext(4, \"Please enter your details below\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"form\", 13, 14);\n    i0.ɵɵlistener(\"submit\", function InitUserComponent_div_4_Template_form_submit_5_listener($event) {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return ctx_r20.updateUserSettings($event);\n    });\n    i0.ɵɵelementStart(7, \"p\", 15);\n    i0.ɵɵtext(8, \"Your Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 16);\n    i0.ɵɵelementStart(10, \"p\", 15);\n    i0.ɵɵtext(11, \"Your Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 17);\n    i0.ɵɵelementStart(13, \"p\", 15);\n    i0.ɵɵtext(14, \"Your Password\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"input\", 18);\n    i0.ɵɵelementStart(16, \"p\", 15);\n    i0.ɵɵtext(17, \"Confirm Password\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 19, 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_4_Template_button_click_20_listener($event) {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.updateUserSettings($event);\n    });\n    i0.ɵɵtext(21, \"Submit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"div\", 22)(23, \"h3\", 23);\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(24);\n    i0.ɵɵtextInterpolate(ctx_r3.statusMsg);\n  }\n}\n\nfunction InitUserComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r24 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 7)(2, \"img\", 8);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_5_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return ctx_r23.state = \"user\";\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"h1\", 5);\n    i0.ɵɵtext(4, \"Please enter your details below\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"form\", 13, 14);\n    i0.ɵɵlistener(\"submit\", function InitUserComponent_div_5_Template_form_submit_5_listener($event) {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return ctx_r25.loginUser($event);\n    });\n    i0.ɵɵelementStart(7, \"p\", 15);\n    i0.ɵɵtext(8, \"Your Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 17);\n    i0.ɵɵelementStart(10, \"p\", 15);\n    i0.ɵɵtext(11, \"Your Password\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_5_Template_button_click_13_listener($event) {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return ctx_r26.loginUser($event);\n    });\n    i0.ɵɵtext(14, \"Submit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 22)(16, \"h3\", 23);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(17);\n    i0.ɵɵtextInterpolate(ctx_r4.statusMsg);\n  }\n}\n\nfunction InitUserComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r29 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 7)(2, \"img\", 8);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_6_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r29);\n      const ctx_r28 = i0.ɵɵnextContext();\n      ctx_r28.state = \"cloud\";\n      return ctx_r28.doCloudSync = true;\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"h1\", 5);\n    i0.ɵɵtext(4, \"Great! Please enter your name below\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"form\", 13, 14);\n    i0.ɵɵlistener(\"submit\", function InitUserComponent_div_6_Template_form_submit_5_listener($event) {\n      i0.ɵɵrestoreView(_r29);\n      const ctx_r30 = i0.ɵɵnextContext();\n      return ctx_r30.createLocalUser($event);\n    });\n    i0.ɵɵelementStart(7, \"p\", 15);\n    i0.ɵɵtext(8, \"Your Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function InitUserComponent_div_6_Template_button_click_10_listener($event) {\n      i0.ɵɵrestoreView(_r29);\n      const ctx_r31 = i0.ɵɵnextContext();\n      return ctx_r31.createLocalUser($event);\n    });\n    i0.ɵɵtext(11, \"Submit\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport let InitUserComponent = /*#__PURE__*/(() => {\n  class InitUserComponent {\n    constructor(connections, globalVars, router) {\n      this.connections = connections;\n      this.globalVars = globalVars;\n      this.router = router;\n      this.state = 'init';\n      this.doCloudSync = true;\n    }\n\n    ngOnInit() {// this.globalVars.wipeStorage();\n    }\n\n    updateCloudState(state) {\n      this.doCloudSync = state === \"Enable Cloud Sync\";\n    }\n\n    loginUser(event) {\n      event.preventDefault();\n      this.globalVars.setVar(\"doCloudSync\", JSON.stringify(this.doCloudSync)); // Get the public key\n\n      this.globalVars.getPublicKey().then(() => {\n        const email = document.getElementById(\"emailInput\").value;\n        const pwd = document.getElementById(\"passwordInput\").value;\n        this.globalVars.setVar(\"userEmail\", email);\n        this.connections.login(email, pwd, this.globalVars.getVar(\"serverPublicKey\")).subscribe(res => {\n          if (res[\"worked\"]) {\n            this.globalVars.setVar(\"passwordToken\", res[\"payload\"][\"Data\"]);\n            this.statusMsg = \"Success!\";\n            setTimeout(() => {\n              this.globalVars.syncFromCloud(true).then(() => {\n                setTimeout(() => {\n                  this.router.navigate([\"\"]);\n                }, 250);\n              });\n            }, 250);\n          }\n\n          if (!res[\"worked\"]) {\n            this.statusMsg = \"Either your username or password is incorrect\";\n            this.showStatusMsg(7500);\n          }\n        });\n      });\n    }\n\n    updateUserSettings(event) {\n      event.preventDefault();\n      this.globalVars.getPublicKey().then(() => {\n        const userName = document.getElementById(\"nameInput\").value;\n        this.globalVars.setVar(\"userName\", userName);\n\n        if (this.doCloudSync) {\n          var email = document.getElementById(\"emailInput\").value; // Ensure entered passwords match\n\n          let password = document.getElementById(\"passwordInput\").value;\n          let confirmedPassword = document.getElementById(\"confirmPasswordInput\").value;\n\n          if (password != confirmedPassword) {\n            this.showStatusMsg(7500);\n            this.statusMsg = \"The passwords you entered do not match\";\n          } else {\n            // Ensure no other account is in the DB with the same user name\n            this.connections.validateUserEmail(email).subscribe(isUniqueEmail => {\n              if (isUniqueEmail) {\n                this.globalVars.setVar(\"userEmail\", email);\n                this.globalVars.setVar(\"passwordLength\", password.length.toString());\n                this.connections.createNewUser(userName, email, password, this.globalVars.getVar(\"serverPublicKey\")).subscribe(res => {\n                  this.statusMsg = \"Saved :)\";\n                  this.showStatusMsg(2500);\n                  this.globalVars.setVar(\"passwordToken\", res);\n                  setTimeout(() => {\n                    this.router.navigate([\"\"]);\n                  }, 3000);\n                });\n              } else {\n                this.statusMsg = \"An account already exists with this email\";\n                this.showStatusMsg(2500);\n              }\n            });\n          }\n        }\n      });\n    }\n\n    showStatusMsg(delay) {\n      var _a;\n\n      (_a = document.getElementById(\"msgBox\")) === null || _a === void 0 ? void 0 : _a.classList.add(\"showError\");\n      setTimeout(() => {\n        var _a;\n\n        (_a = document.getElementById(\"msgBox\")) === null || _a === void 0 ? void 0 : _a.classList.remove(\"showError\");\n      }, delay);\n    }\n\n    createLocalUser(event) {\n      event.preventDefault();\n      let name = document.getElementById(\"localNameInput\").value; // Init user with default/empty values\n\n      this.globalVars.setVar(\"userName\", name);\n      this.globalVars.setVar(\"doCloudSync\", JSON.stringify(false));\n      this.globalVars.setVar(\"wk1Data\", JSON.stringify([]));\n      this.globalVars.setVar(\"wk2Data\", JSON.stringify([]));\n      this.globalVars.setVar(\"wk1IsWkA\", JSON.stringify(false));\n      this.globalVars.setVar(\"noteList\", JSON.stringify([]));\n      this.globalVars.setVar(\"studyNoteList\", JSON.stringify([]));\n      this.globalVars.setVar(\"widgetsLayout\", JSON.stringify([]));\n      this.globalVars.setVar(\"lastSignInTime\", JSON.stringify(new Date().getTime()));\n      setTimeout(() => {\n        this.router.navigate([\"/\"]);\n      }, 250);\n    }\n\n  }\n\n  InitUserComponent.ɵfac = function InitUserComponent_Factory(t) {\n    return new (t || InitUserComponent)(i0.ɵɵdirectiveInject(i1.ConnectionsService), i0.ɵɵdirectiveInject(i2.GlobalVarsService), i0.ɵɵdirectiveInject(i3.Router));\n  };\n\n  InitUserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: InitUserComponent,\n    selectors: [[\"app-init-user\"]],\n    decls: 7,\n    vars: 6,\n    consts: [[1, \"setup-container\"], [\"class\", \"heading-container\", 4, \"ngIf\"], [\"class\", \"heading-container heading-container-large\", 4, \"ngIf\"], [1, \"heading-container\"], [\"src\", \"../../../../assets/app-icon.svg\", \"alt\", \"\", 1, \"iconImg\"], [1, \"heading-text\"], [1, \"heading-text\", \"heading-btn\", \"animated-hover\", 3, \"click\"], [1, \"heading-arrow-container\"], [\"src\", \"../../../../assets/scroll.svg\", \"alt\", \"Go Back\", 1, \"heading-arrow-img\", \"white\", 3, \"click\"], [1, \"heading-toggle\"], [3, \"label1\", \"label2\", \"defaultVal\", \"elemID\", \"state\"], [1, \"heading-text\", \"heading-btn\", \"animated-hover\", \"account-btn\", 3, \"click\"], [1, \"heading-container\", \"heading-container-large\"], [1, \"form-container\", 3, \"submit\"], [\"userForm\", \"\"], [1, \"form-text\"], [\"type\", \"text\", \"name\", \"Name\", \"id\", \"nameInput\", \"placeholder\", \"Name\", 1, \"form-input\"], [\"type\", \"text\", \"name\", \"Email\", \"id\", \"emailInput\", \"placeholder\", \"Email\", 1, \"form-input\"], [\"type\", \"password\", \"name\", \"Password\", \"id\", \"passwordInput\", \"placeholder\", \"Password\", 1, \"form-input\"], [\"type\", \"password\", \"name\", \"Password\", \"id\", \"confirmPasswordInput\", \"placeholder\", \"Password\", 1, \"form-input\"], [\"confirmInput\", \"\"], [1, \"heading-text\", \"heading-btn\", \"animated-hover\", \"form-btn\", 3, \"click\"], [\"id\", \"msgBox\", 1, \"msg-container\"], [1, \"msg-text\"], [\"type\", \"text\", \"name\", \"Name\", \"id\", \"localNameInput\", \"placeholder\", \"Name\", 1, \"form-input\"]],\n    template: function InitUserComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, InitUserComponent_div_1_Template, 8, 0, \"div\", 1);\n        i0.ɵɵtemplate(2, InitUserComponent_div_2_Template, 11, 4, \"div\", 1);\n        i0.ɵɵtemplate(3, InitUserComponent_div_3_Template, 13, 0, \"div\", 1);\n        i0.ɵɵtemplate(4, InitUserComponent_div_4_Template, 25, 1, \"div\", 2);\n        i0.ɵɵtemplate(5, InitUserComponent_div_5_Template, 18, 1, \"div\", 1);\n        i0.ɵɵtemplate(6, InitUserComponent_div_6_Template, 12, 0, \"div\", 1);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"init\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"cloud\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"user\" && ctx.doCloudSync == true);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"signup\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"login\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.state == \"user\" && ctx.doCloudSync == false);\n      }\n    },\n    directives: [i4.NgIf, i5.ToggleSwitchComponent],\n    styles: [\".heading-container[_ngcontent-%COMP%]{height:80%;width:90%;background:linear-gradient(to top,#0f0c29,#191444);border-radius:15px 0;animation:scale-in-center .65s ease}.heading-container-large[_ngcontent-%COMP%]{height:90%}.heading-text[_ngcontent-%COMP%]{animation:tracking-in-expand 1s ease}.heading-btn[_ngcontent-%COMP%]{animation:scale-in-center 1.2s ease!important;height:15%;width:25%;margin-top:30px;background-color:var(--mid-bg-color);border:none;border-radius:15px 0}.heading-toggle[_ngcontent-%COMP%]{width:300px;height:50px;margin:15px auto auto}.heading-arrow-container[_ngcontent-%COMP%]{position:relative;top:5%;left:1.75%;height:15px;width:15px}.heading-arrow-img[_ngcontent-%COMP%]{transform:rotate(90deg);transition:all .2s ease}.heading-arrow-img[_ngcontent-%COMP%]:hover{cursor:pointer;transform:rotate(110deg)}.account-btn[_ngcontent-%COMP%]{margin-left:30px;height:80px}.setup-container[_ngcontent-%COMP%]{height:99vh;width:99vw;position:absolute;top:0%;left:0%;background:linear-gradient(to bottom,#0f0c29,#191444);z-index:10!important;display:flex;align-items:center;justify-content:center}.form-container[_ngcontent-%COMP%]{height:55%;width:85%;margin:auto;display:grid;grid-template-columns:1fr 2fr;grid-row-gap:0px;row-gap:0px;grid-template-rows:auto auto auto}.form-input[_ngcontent-%COMP%]{transition:all .3s ease;margin:0;border:1px red solid;height:40px;background-color:var(--bottom-bg-color);border:none}.form-text[_ngcontent-%COMP%]{transition:all .3s ease}.form-btn[_ngcontent-%COMP%]{margin-top:10px;height:15%}.msg-container[_ngcontent-%COMP%]{height:15%;width:100%;background-color:var(--top-bg-color);transform:translate(-100vw);transition:all 1s ease;text-align:center;border-radius:15px 0;animation:hide 2s linear}.msg-text[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:400}.showError[_ngcontent-%COMP%]{transform:translate(0)}@keyframes hide{0%{opacity:0}99%{opacity:0}to{opacity:1}}.iconImg[_ngcontent-%COMP%]{animation:scale-in-center 1.2s ease!important;height:40%;aspect-ratio:1/1}\"]\n  });\n  return InitUserComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}